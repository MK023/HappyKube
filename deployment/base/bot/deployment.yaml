# HappyKube Telegram Bot Deployment
apiVersion: apps/v1
kind: Deployment
metadata:
  name: happykube-bot
  namespace: happykube
  labels:
    app: happykube-bot
    component: bot
    version: v2.0.0
spec:
  replicas: 1  # Bot should be single replica
  selector:
    matchLabels:
      app: happykube-bot
  template:
    metadata:
      labels:
        app: happykube-bot
        component: bot
        version: v2.0.0
    spec:
      containers:
      - name: bot
        image: emmekappa23/happykube-bot:v2.0.0  # Update with your image
        imagePullPolicy: Always
        env:
        # Application
        - name: APP_ENV
          value: "production"
        - name: APP_NAME
          value: "HappyKube"
        - name: APP_VERSION
          value: "2.0.0"
        - name: DEBUG
          value: "False"
        - name: LOG_LEVEL
          value: "INFO"

        # Database (Neon)
        - name: DB_HOST
          valueFrom:
            secretKeyRef:
              name: happykube-secrets
              key: db-host
        - name: DB_PORT
          value: "5432"
        - name: DB_NAME
          valueFrom:
            secretKeyRef:
              name: happykube-secrets
              key: db-name
        - name: DB_USER
          valueFrom:
            secretKeyRef:
              name: happykube-secrets
              key: db-user
        - name: DB_PASSWORD
          valueFrom:
            secretKeyRef:
              name: happykube-secrets
              key: db-password

        # Redis
        - name: REDIS_HOST
          value: "redis"
        - name: REDIS_PORT
          value: "6379"

        # Security
        - name: ENCRYPTION_KEY
          valueFrom:
            secretKeyRef:
              name: happykube-secrets
              key: encryption-key
        - name: JWT_SECRET_KEY
          valueFrom:
            secretKeyRef:
              name: happykube-secrets
              key: jwt-secret
        - name: API_KEYS
          valueFrom:
            secretKeyRef:
              name: happykube-secrets
              key: api-keys

        # Telegram
        - name: TELEGRAM_BOT_TOKEN
          valueFrom:
            secretKeyRef:
              name: happykube-secrets
              key: telegram-token

        # ML Models
        - name: ITALIAN_EMOTION_MODEL
          value: "MilaNLProc/feel-it-italian-emotion"
        - name: ENGLISH_EMOTION_MODEL
          value: "j-hartmann/emotion-english-distilroberta-base"
        - name: SENTIMENT_MODEL
          value: "MilaNLProc/feel-it-italian-sentiment"

        # Messages (localization)
        - name: MESSAGES_WELCOME
          value: "Ciao! ðŸ˜Š Sono HappyKube v2! Dimmi come ti senti oggi!"
        - name: MESSAGES_ASK_EMOTION
          value: "Dimmi come ti senti, sono qui per ascoltarti!"
        - name: MESSAGES_THANKS
          value: "Grazie per aver condiviso!"
        - name: MESSAGES_ERROR
          value: "Ops! Qualcosa Ã¨ andato storto. Riprova tra poco."
        - name: MESSAGES_EMPTY
          value: "Non ho ricevuto alcun testo. Puoi riprovare?"
        - name: MESSAGES_NOT_IDENTIFIED
          value: "Errore: utente non identificato."

        resources:
          requests:
            cpu: "250m"
            memory: "512Mi"
          limits:
            cpu: "1"
            memory: "2Gi"
